<!DOCTYPE html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="jakarta.faces.html"
  xmlns:f="jakarta.faces.core"
  xmlns:pt="jakarta.faces.passthrough"
  xmlns:jsf="jakarta.faces"
  xmlns:ui="jakarta.faces.facelets"
  xmlns:p="primefaces">

<h:head>
  <title>PrimeFaces Test</title>
  <h:outputScript name="test.js" />
  <h:outputStylesheet name="test.css" />
</h:head>
<h:body>

  <h1>#{testView.string}</h1>
  <h:form id="main">
    <p:commandButton
      value="Show"
      type="button"
      icon="pi pi-external-link"
      update=":frmTest"
      onclick="PF('dlg').show()" />
  </h:form>

  <p:dialog
    widgetVar="dlg"
    resizable="false"
    showEffect="clip"
    hideEffect="fold"
    modal="true"
    dynamic="true"
    closeOnEscape="true"
    width="100vw"
    height="100vh">
    <h:form id="frmTest">
      <p:dataTable
        id="tblJpa"
        widgetVar="jpaTable"
        var="row"
        value="#{testView.lazyDataModel}"
        rows="5"
        rowKey="#{row.id}"
        selectionMode="single"
        selection="#{testView.selectedRow}">
        <p:ajax
          event="rowSelect"
          listener="#{testView.onRowSelect}"
          update="@this :frmTest:childTableBox" />
        <p:ajax
          event="rowUnselect"
          update="@this :frmTest:childTableBox" />
        <p:column field="id" />
        <p:column field="stringCol" />
        <p:column
          field="numberCol"
          filterMatchMode="gt" />
        <p:column
          field="decimalCol"
          filterMatchMode="gt" />
        <p:column field="dateCol">
          <f:facet name="filter">
            <p:datePicker onchange="PF('jpaTable').filter()" />
          </f:facet>
        </p:column>
      </p:dataTable>

      <h:panelGroup
        id="childTableBox"
        layout="block"
        styleClass="#{testView.selectedRow != null ? 'child-table-box' : ''}">
        <p:dataTable
          id="tblChild"
          widgetVar="childTable"
          var="child"
          value="#{testView.selectedRow.children}"
          rowKey="#{child.id}"
          selectionMode="multiple"
          selection="#{testView.selectedChildren}"
          selectionRowMode="none"
          rows="5"
          rendered="#{not empty testView.selectedRow.children}">
          <p:column
            selectionBox="true"
            style="width:1.5rem;text-align:center" />
          <p:column field="id" />
          <p:column field="stringCol" />
          <p:column
            field="numberCol"
            filterMatchMode="gt" />
          <p:column
            field="decimalCol"
            filterMatchMode="gt" />
          <p:column headerText="Details">
            <p:commandLink
              actionListener="#{testView.onClickDetailsIcon(child)}"
              update=":frmTest:detailsIconPanel"
              oncomplete="PF('detailsIconWidget').show('#{component.clientId}')"
              rendered="#{not empty child.details}">
              <em class="pi pi-search" />
            </p:commandLink>
          </p:column>
        </p:dataTable>
      </h:panelGroup>

      <p:overlayPanel
        id="detailsIconPanel"
        widgetVar="detailsIconWidget"
        dynamic="true"
        style="width:400px">
        <h:outputText value="#{testView.detailsMessage}" />
      </p:overlayPanel>
    </h:form>
  </p:dialog>

</h:body>
</html>
